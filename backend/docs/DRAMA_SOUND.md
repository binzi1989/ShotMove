# 短剧成片：环境音与音效说明

短剧成片可叠加三类声音：**配音（TTS）**、**环境音/氛围音**、**自定义音效**。后两者均可通过环境变量配置。

---

## 1. 环境音 / 氛围音（默认开启）

- **作用**：整段成片铺一层轻柔、无旋律的环境音，增强沉浸感，避免「干声」。
- **实现**：使用当前 BGM 引擎（如 MiniMax 音乐）按提示词生成一段「轻柔环境音 无旋律 影视剧氛围…」的音频，以约 0.15 音量与配音混在一起。
- **配置**：在 `.env` 中设置  
  `DRAMA_AMBIENT_ENABLED=true`（默认）或 `false` 关闭。

---

## 2. 自定义音效（可选）

- **作用**：在配音 + 环境音之外，再叠一层你自己准备的音效（如室内底噪、街道环境、轻微风声等），整段或前一段会随音效文件长度播放。
- **实现**：你提供一个 **mp3 文件路径**，成片混音时会以约 0.2 音量与配音、环境音一起混入。
- **配置**：在 `.env` 中设置  
  `DRAMA_SFX_PATH=你的音效文件路径`

**路径写法**：

- **绝对路径**（推荐）：  
  `DRAMA_SFX_PATH=D:/project/backend/static/sfx/room_tone.mp3`
- **相对 backend 根目录**：  
  `DRAMA_SFX_PATH=./static/sfx/room_tone.mp3`  
  或  
  `DRAMA_SFX_PATH=static/sfx/room_tone.mp3`

**建议**：

- 音效文件不要太响，避免盖过对白；当前混音时音效轨音量约为 0.2，可按需再压低源文件音量。
- 若成片比音效长，音效播完后为静音；若音效比成片长，会按成片时长截断。
- 可从免版权音效站（如 Freesound、爱给网等）下载「环境底噪」「室内」「街道」等 mp3，放到项目目录后把路径填到 `DRAMA_SFX_PATH`。

**示例**：

1. 在 `backend/static/sfx/` 下放入 `room_tone.mp3`。
2. 在 `.env` 中写：  
   `DRAMA_SFX_PATH=./static/sfx/room_tone.mp3`
3. 重启后端，再生成短剧成片即可听到配音 + 环境音 + 该音效。

---

## 3. 语速（配音）

- **作用**：控制短剧 TTS 语速，数值越小语速越慢。
- **配置**：  
  `TTS_DRAMA_SPEED=32`（默认，偏慢易听清）  
  可改为 28–30 更慢，或 35–40 稍快；50 为引擎默认正常语速。

---

## 4. 配音与镜头对齐（可调）

- **作用**：短剧按镜配音时，每镜 TTS 生成后会用其实际时长作为该镜目标时长，再裁切/补齐视频与音轨对齐。若感觉「话没说完就切」或「镜头等太久」，可调以下参数。
- **配置**：
  - `DRAMA_TTS_TAIL_PAD_SEC=0.25`：每镜配音末尾预留静音（秒），避免话尾被裁断。可改为 0.15–0.4 微调。
  - `DRAMA_MIN_SHOT_SEC=1.0`：每镜最短时长（秒）。**严格按配音长度**时设为 1.0，镜头时长 = TTS 实际时长 + 尾缓冲，多余裁掉；若希望短句也至少 2.5 秒可改为 2.5。
  - `DRAMA_VOICE_SCALE_TOLERANCE=0.5`：配音总长与成片时长差异超过此值（秒）时才等比缩放各镜时长；小于此值不缩放，减少错位。可改为 0.3–1.0。

---

## 5. 小结

| 项目           | 环境变量                     | 说明 |
|----------------|------------------------------|------|
| 环境音/氛围音  | `DRAMA_AMBIENT_ENABLED`      | 默认 true；false 关闭自动生成的氛围音。 |
| 自定义音效     | `DRAMA_SFX_PATH`             | 可选；填 mp3 路径即混入，留空不叠加。 |
| 配音语速       | `TTS_DRAMA_SPEED`             | 默认 32；越小越慢。 |
| 配音尾缓冲     | `DRAMA_TTS_TAIL_PAD_SEC`      | 每镜配音末尾预留秒数，默认 0.25。 |
| 每镜最短时长   | `DRAMA_MIN_SHOT_SEC`         | 每镜最短秒数，默认 1.0（严格按配音长度，多余裁掉）。 |
| 对齐缩放容差   | `DRAMA_VOICE_SCALE_TOLERANCE`| 配音总长与成片差超过此值才缩放，默认 0.5。 |

混音顺序：**配音（主） + 环境音（若有） + 自定义音效（若有）**，三者同时存在时一起叠在成片上。

情绪与语速：若在 `.env` 中设置 `DRAMA_EMOTION_SPEED_DELTA=1`，会根据每镜情绪微调语速（激动/开心略快、难过/冷淡略慢），增强情感层次。
